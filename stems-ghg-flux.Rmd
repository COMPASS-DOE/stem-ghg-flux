---
title: "stem-ghg-flux"
author: "EP"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
theme_set(theme_bw())
library(arrow)
library(readr)
```

# Science questions

1. How much do tree stem GHG fluxes vary over the course of the year?
2. ...

# Read data

```{r read-data}
# Data file from the TEMPEST repository
message("Reading data...")
dat <- read_parquet("tempest_tree_ghg_fluxes.parquet")

message(nrow(dat), " rows and ", ncol(dat), " columns")
```

# Quick summary and visualization of data

```{r quick-look}
glimpse(dat)

# 1. Print summary
summary(dat)
# 2. ggplot(dat, ...)

```

# Join with species data

```{r sapflow-trees}
# 3. Drop existing species column from dat
# 4. Read in TEMPEST_Trees_Instruments.csv

tree_instruments <- read.csv("TEMPEST_Trees_Instruments.csv")

# 5. Join -- probably using left_join()

dat %>%
  mutate(Sapflux_ID = ID) %>%
  left_join(tree_instruments, by = "Sapflux_ID") -> tree_dat

# optional cleaning
tree_dat %>%
  mutate(spp = case_when(
    spp == "ACRU" ~ "Red Maple",
    spp == "LITU" ~ "Tulip Poplar",
    spp == "FAGR" ~ "American Beech"
  )) -> tree_dat


```

# Plot annual cycle

```{r}
# 1: remove TEMPEST flood measurements

```

# figure/graph practice 

```{r}

ggplot(data = dat, mapping = aes(x = Date, y = CO2_lin_flux.estimate, color = as.factor(ID))) +
  geom_point() + # Add a layer of points
  labs(title = "Practice",
       x = "X",
       y = "Y",
       color = "ID") + # Add labels and a title
  theme_minimal() # Apply a clean theme
```
